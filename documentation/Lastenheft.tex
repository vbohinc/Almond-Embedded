\documentclass[12pt,a4paper]{article}

\usepackage[german]{babel}
\usepackage[utf8]{inputenc}
\usepackage[pdftex]{graphicx}
\usepackage{fancyhdr,lastpage}
\usepackage{enumerate}
\usepackage{amsmath, amsthm, amssymb}
\usepackage[top=3cm, bottom=3cm, left=2cm, right=2cm]{geometry}
\usepackage{minitoc}
\pagestyle{fancy}

% Header
\lhead{Projekt Almond}
\chead{Lastenheft}
\rhead{Seite \thepage /\pageref{LastPage} }

\begin{document}

\begin{titlepage}
	\begin{center}
		\includegraphics[height=15cm]{./logo.pdf}\\
		{\LARGE \bf Lastenheft}\\[0.3cm]
		{\large und Projektübersicht}
	\end{center}
\end{titlepage}

\tableofcontents

% Inhalt

\section{Übersicht}

Almond ({\bf A}utonomous {\bf L}ogging and {\bf M}anagement of {\bf N}etworked {\bf D}evices) ist ein System aus vernetzten Aktoren und Sensoren (sog. Nuts (Networked Utilities and Sensors)), die über einen zentralen Controller (Squirrel) gesteuert werden. Zusätzlich gibt es ein Backend für PCs, welches über eine Weboberfläche Zugriff auf Gerätedaten gibt und die Steuerung der Aktoren sowie Konfigurationsänderungen erlaubt.\\
Die einzelnen Geräte werden über ein dafür entwickeltes Protkoll via Bluetooth mit dem Controller verbunden. Der Controller selbst wird dann ebenfalls über Bluetooth mit dem auf einem Linux/Windows/Mac laufenden Backend verbunden. Dabei werden auch Logdaten (Verlauf der Sensorwerte) mit übermittelt, die dann später auf dem Rechner ausgewertet werden können.

\section{Teilnehmer und Aufgabenverteilung}

Den 9 Teilnehmern sind folgende Aufgabenbereiche im Projekt zugeteilt:\\

\begin{itemize}
	\item {\bf Salomon Sickert}: Teamleiter, Downlink-/Uplink Protokoll Design, Controller
	\item {\bf Pascal Schnurr}: Backend Bluetooth Interface ... (bitte ergänzen)
	\item {\bf Matthias Schwab}: Backend, Webinterface
	\item {\bf Christian Rupprecht}: I/O Interface für Controller (SD Karte), ... (bitte ergänzen)
	\item {\bf Seán Labastille}: Controller, Up-/Downlink Protokolldsign
	\item {\bf Stefan Profanter}: Bluetooth Implementation Aktoren/Sensoren/Backend
	\item {\bf Linus Lotz}: Boardesign Aktoren/Sensoren/Backend, ... (bitte ergänzen)
	\item {\bf Thomas Parsch}: Displaysteuerung Controller, ... (bitte ergänzen)
	\item {\bf Maximilian Karl}: Boardesign Aktoren/Sensoren/Backend, ... (bitte ergänzen)
\end{itemize}

Die einzelnen Projektteile werden im Folgenden genauer erläutert.

\section{Controller}

\subsection{Aufbau}

Der Controller (Squirrel) basiert auf einem Atmel XMega 128a1 AVR Mikroprozessor.
Er dient als Zentrale für das System welches autark vom Rechner arbeitet, und auch als Schnittstelle zum Rechner.
Am Controller selbst befindet sich zusätzlich ein SD-Kartenleser für die Speicherung von Logdaten, ein Display mit Tasten für Statusüberprüfung und ggf. Konfigurationsänderungen.
Wie alle Client-Geräte (Nuts) besitzt der Controller ein Bluetoothmodul.\\

\subsection{Features}
Mit dem Downlink-Protokoll spricht die Squirrel seine Nuts an und empfängt Daten von diesen. Die Squirrel führt Buch über die ihr bekannten Geräte und speichert diese intern zwecks Identifizierung, Displayausgabe, Logverwaltung und Konfiguration durch das Backend.\\
Mit dem Uplink-Protokoll kommuniziert die Squirrel mit dem Backend. Hiermit werden Logdaten zum Rechner geladen und Konfigurationsdaten der Nuts und auch der Squirrel selbst ausgetauscht.
Aus dem Entwurf des Downlink-Protokolls ergibt sich theoretisch die Möglichkeit 254 Geräte mit je insgesamt 254 Sensoren, Aktoren und Konfigurationseinstellungen anzusprechen. Die von diesen Geräten ausgegebenen Sensordaten werden geloggt, Aktoren können gesteuert werden und die Konfiguration entsprechend angepasst werden.

\subsection{Zeitplan}
\begin{enumerate}
	\item Anfangs zielt die Entwicklungsarbeit auf die Übermittlung von Datenpacketen über Downlink zwischen Nuts und Squirrel. Sobald diese Problemlos möglich ist und sofern nicht bereits implementiert müssen bekannte und/oder sichtbare Geräte in einer internen Datenstruktur verwaltet werden. (2 Wochen)
	\item Nun sollte, je nach Entwicklungsstand der anderen Komponenten, die Anzeige der bekannten Daten auf dem Display, die Übergabe per Uplink an den Rechner und das Loggen auf SD-Karte implementiert werden. (4 Wochen)
	\item Hierauf folgt die Umsetzung von Konfigurationsmöglichkeiten per Uplink oder Display. (1 Woche)
\end{enumerate}

\subsection{Display}



\subsection{Speicherung (SD-Karte)}

\subsection{Zeitplan}





\subsection{mögliche Erweiterungen}
Eine wünschenswerte Erweiterung wäre die Möglichkeit timergesteuert Aktoren auszulösen oder auf Zustandsänderungen bei einem Sensor zu reagieren.





\section{Aktor/Sensor Hardware}

\subsection{Aufbau}


Hier kommt Text zum Controller hin..

\subsection{mögliche Erweiterungen}


\section{Protokolle}

\subsection{Uplink}
\label{subsec:uplink}


Verwendet für die Kommunikation zwischen Backend und Controller.\\
Über Bluetooth werden hier Pakete fester größe ausgetauscht um: Logdaten ans Backend zu übermitteln, die Konfiguration einzelner Nuts abzurufen oder zu ändern und schließlich die Squirrel selbst zu konfigurieren.

\subsection{Downlink}
\label{subsec:downlink}

Verwendet für die Kommunikation zwischen Aktor/Sensor Hardware und Controller.\\
Über Bluetooth werden Pakete fester größe ausgetauscht um: Daten von den Nuts abzurufen, d.h. Sensordaten und Geräteinformationen, sowie Konfigurationsänderungen und Aktoren auszulösen. 

\subsection{Bluetooth}
Das Squirrel besitzt ein BTM-222 Bluetooth Modul zur Kommunikation mit den Nuts, welche ebenfalls das BTM-222 Modul verwenden, sowie mit dem Computer. Zur Verbindung mit dem Computer wird wird bereits ein existierendes Bluetooth Modul am PC vorausgesetzt. 
Um die Verbindung zwischen dem Microcontroller und dem BTM-222 Modul über USART herzustellen, wurde ein eigener Code entwickelt.\\
Sobal das Squirrel mit einem Nut oder dem PC verbunden ist, wird ein proprietäres Protokoll verwendet, um die Daten auszutauschen. (Siehe: \ref{subsec:uplink} sowie \ref{subsec:downlink}). Da die Datenpakete jeweils eine feste größe haben, muss gewährleistet werden, dass im Falle einer Störung oder eines Übertragungsfehlers das Ende eines Paketes wieder erkannt wird. Deshalb werden am Ende eines jeden Paketes zwei spezielle Byte gesendet: das Special- und Stop-Byte. Dies kann man sich als '$\backslash$0'vorstellen. Damit nicht zufällig mit den gesendeten Daten ein falsches Ende erkannt wird, wird vor jedem Byte, welches den selben Wert hat wie das Special-Byte ein weiteres Special-Byte eingefügt (z.B. '3$\backslash$04' wird zu '3$\backslash\backslash$04' und dann erst übertragen). Beim Empfangen werden dann die doppelten Special Bytes wieder mit einem ersetzt und dadurch erkannt, dass die Bytes kein Ende darstellen.\\
Zur Kommunikation mit dem PC werden ebenfalls feste Datenpakete verwendet wobei dort auch das Prinzip mit den Special- und Stop-Byte Anwendung findet (weitere Details siehe \ref{subsec:BTBackend}).

\section{Backend}

\subsection{Aufbau}

Das Backend ist ein Softwarepaket für Linux, Windows oder Mac OS X basierte Computer. Mit dem Backend ist es möglich über eine Web basierte Oberfläche auf die Sensordaten der vernetzten Geräte zuzugreifen. Die Backend Software kommuniziert über ein Bluetooth-Protokoll mit der Controller Hardware. Dabei werden zum einen aktuelle Sensorwerte übermittelt, wie auch auf dem Controlle gespeicherte Log-Daten zum Verlauf der Sonsorwerte seit dem letzten Update.\\
Als Webserver kommt der {\bf lighttpd} zum Einsatz. Zusätzlich wird eine lokale {\bf MySQL} Datenbank zur Speicherung von Einstellungen und Daten auf der Backend-Seite verwendet.\\
Die Software zur Kommunikation mit dem Backend wird in C++ entwickelt und schreibt empfangene Daten direkt in die Datenbank.\\
Für die Darstellung der Web-Oberfläche wird eine in {\bf Perl} entwickelte Software verwendet, die auf die selbe Datenbank zugreift um zB aktuelle Sensorwerte anzuzeigen oder Diagramme und Graphen mithilfe der verfügbaren Log-Daten zu erzeugen oder Einstellungen für den Controller zu ändern.\\
Der Vorteil der Weboberfläche ist, dass der Backend Server so von jedem Browser aus bedient werden kann (inklusiver Mobiler Endgeräte) und so eine bestmögliche Integration des Systems ermöglicht wird.

\subsection{Backend Bluetooth Interface}
\label{subsec:BTBackend}

Hier kommt Text zum C++ und Bluetooth Teil des Backends hin...

\subsection{Uplink Protokoll}

Hier kommt die Spezifikation des Uplink Protokolls hin...

\subsection{Web Oberfläche}

\subsubsection{Funktionsweise}

Die Weboberfläche wird mit Perl über das CGI Interface des lighttpd Servers verfügbar gemacht. Es wird keine Perl Installation auf dem Rechner vorausgesetzt, da eine Version inklusive der benötigten Module bereits mitgeliefert wird. Ein MySQL Server wird auch mitgeliefert und mit dem Backend und Webserver gestartet.

%\subsubsection{Installation}
%\subsubsection{Oberfläche}
%\subsubsubsection{Dashboard}
%\subsubsubsection{Log Ansicht}
%\subsubsubsection{Einstellungen}

\subsection{Zeitplan}
\subsection{mögliche Erweiterungen}



\end{document}
